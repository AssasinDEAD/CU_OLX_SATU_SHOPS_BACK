üöÄ Backend OLX/Satu Tasks & Orders
–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, —Ä–µ—à–µ–Ω–∏—è –∏ –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –Ω–∞—à–µ–≥–æ –±—ç–∫–µ–Ω–¥–∞ –∑–∞–¥–∞—á, –º–∞—Ç—á–µ–π –∏ –∑–∞–∫–∞–∑–æ–≤ —Å OLX/Satu. –ú—ã –¥–µ–ª–∞–µ–º —É–ø–æ—Ä –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –¥–µ–Ω–µ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ Docker/Nginx/PostgreSQL/RabbitMQ. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è README –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è: —á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ ‚úÖ, —á—Ç–æ –¥–∞–ª—å—à–µ üîú, –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å üõ†Ô∏è.

üåç –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞
–§—Ä–æ–Ω—Ç —Å–æ–æ–±—â–∞–µ—Ç –∑–∞–¥–∞—á—É: –Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–∫—É–ø–∏—Ç—å —à–≤–∞–±—Ä—É¬ª üßπ.

–ë—ç–∫ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–¥–∞—á—É, –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏, –¥–µ—Ä–≥–∞–µ—Ç API –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ (OLX ‚Üí Satu).

–ù–∞—Ö–æ–¥–∏—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ç–æ–≤–∞—Ä—ã, —Ä–∞–Ω–∂–∏—Ä—É–µ—Ç, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –º–∞—Ç—á–∏, –≤—ã–±–∏—Ä–∞–µ—Ç —Å–∞–º—ã–π –¥–µ—à–µ–≤—ã–π üí∞.

–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª—è–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î, —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –∫—É—Ä—Å USD‚ÜíKZT, –ø–æ—Å—Ç–∞–≤—â–∏–∫, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∞—É–¥–∏—Ç.

RabbitMQ üêá ‚Äî —à–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π: –¥–∞–Ω–Ω—ã–µ –∏–∑ 1–° ‚Üí –æ—á–µ—Ä–µ–¥—å ‚Üí –Ω–∞—à consumer ‚Üí –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∞.

‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ
üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫: controllers, services, repositories, models, db, utils, middleware, routes, config.

üê≥ Docker Compose:

api (Node.js, –ø–æ—Ä—Ç 3001)

db (PostgreSQL)

nginx (reverse proxy)

mq (RabbitMQ)

‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥ –æ–∫—Ä—É–∂–µ–Ω–∏—è (src/config/env.js): JWT, Postgres, OLX/Satu, RabbitMQ, currency API.

üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–∏–≥—Ä–∞—Ü–∏–∏:

–¢–∞–±–ª–∏—Ü—ã: sources, suppliers, tasks, products, task_matches, orders, idempotency_keys, audits.

–ü–æ–ª—è usd_kzt_rate NUMERIC(10,4) –≤ products –∏ orders.

UUID PK, —Å–≤—è–∑–∏, –∏–Ω–¥–µ–∫—Å—ã.

pool.js + migrations-run.js.

üì® RabbitMQ:

tasks_queue ‚Äî –∑–∞–¥–∞—á–∏ –æ—Ç 1–°.

consumer.js ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç source, task, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, –∞—É–¥–∏—Ç.

tasks_retry_10m ‚Äî –æ—á–µ—Ä–µ–¥—å —Å TTL 10 –º–∏–Ω—É—Ç.

tasks_dead_final ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π DLQ.

deadLetterConsumer.js ‚Äî —Å–ª—É—à–∞–µ—Ç DLQ, –ª–æ–≥–∏—Ä—É–µ—Ç –∏ –ø–∏—à–µ—Ç –∞—É–¥–∏—Ç.

üõ†Ô∏è Repositories:

source.repo.js, tasks.repo.js, idempotency.repo.js, suppliers.repo.js, products.repo.js, orders.repo.js, audits.repo.js.

üìú –ê—É–¥–∏—Ç:

–¢–∞–±–ª–∏—Ü–∞ audits.

–ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤—Å—ë: –ø—Ä–∏—Ö–æ–¥ –∑–∞–¥–∞—á–∏, —Å–æ–∑–¥–∞–Ω–∏–µ source/task/order, –æ—à–∏–±–∫–∏, –≤—Ö–æ–¥/–≤—ã—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

recordAudit() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ consumer –∏ HTTP‚Äë—Å–ª–æ–µ.

üîí –ü—Ä–∏–Ω—Ü–∏–ø—ã:

–°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è, —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π error middleware.

–î–µ–Ω–µ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö.

–õ–æ–≥–∏ –∫–∞–∫ JSON, –±–µ–∑ –ø–∞–¥–µ–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å–∞.

üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
–ö–æ–¥
src/
‚îú‚îÄ‚îÄ config/env.js
‚îú‚îÄ‚îÄ db/pool.js, migrations/migrations.js, migrations-run.js
‚îú‚îÄ‚îÄ rabbit/connection.js, queues.js
‚îú‚îÄ‚îÄ consumers/consumer.js, deadLetterConsumer.js
‚îú‚îÄ‚îÄ repositories/\*.repo.js
‚îú‚îÄ‚îÄ controllers/
‚îú‚îÄ‚îÄ services/
‚îú‚îÄ‚îÄ routes/
‚îú‚îÄ‚îÄ utils/
‚îú‚îÄ‚îÄ middleware/
‚îî‚îÄ‚îÄ index.js
üóÑÔ∏è –°—Ö–µ–º–∞ –ë–î
sources ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∑–∞–¥–∞—á (1–°/EspoCRM).

suppliers ‚Äî –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏.

tasks ‚Äî –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–¥–∞—á–∏ (specs, qty, status, idempotency_key).

products ‚Äî —Ç–æ–≤–∞—Ä—ã —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤.

task_matches ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–∞—Ç—á–µ–π.

orders ‚Äî –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã.

idempotency_keys ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–æ–≤.

audits ‚Äî –∞—É–¥–∏—Ç –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π.

üõ†Ô∏è –ó–∞–ø—É—Å–∫
‚öôÔ∏è .env:

–ö–æ–¥
NODE_ENV=development
PORT=3001
FRONTEND_URL=http://localhost:3000
JWT_SECRET=your_jwt_secret
JWT_EXPIRY=1h
PG_HOST=db
PG_PORT=5432
PG_USER=postgres
PG_PASSWORD=postgres
PG_DATABASE=shopdb
OLX_API_URL=https://api.olx.example.com
SATU_API_URL=https://api.satu.example.com
CURRENCY_SOURCE_URL=https://api.exchangerate-api.com/v4/latest/USD
RABBITMQ_URL=amqp://mq:5672
üê≥ Docker:

bash
docker-compose up -d
üóÑÔ∏è –ú–∏–≥—Ä–∞—Ü–∏–∏:

bash
node src/db/migrations-run.js
üêá RabbitMQ:

bash
node src/index.js
‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç consumer.js –∏ deadLetterConsumer.js.

üîú –ß—Ç–æ –¥–∞–ª—å—à–µ
üß© –°–µ—Ä–≤–∏—Å—ã –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∏: –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π, –ø–æ–∏—Å–∫/—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤, —Å–æ–∑–¥–∞–Ω–∏–µ task_matches.

üåê –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: OLX ‚Üí Satu API.

üì¶ –û—á–µ—Ä–µ–¥—å orders_queue + consumer –¥–ª—è –∑–∞–∫–∞–∑–æ–≤.

üõ°Ô∏è Middleware –¥–ª—è –∞—É–¥–∏—Ç–∞ HTTP‚Äë–∑–∞–ø—Ä–æ—Å–æ–≤ (login/logout, API –≤—ã–∑–æ–≤—ã).

üìë Controllers + Routes –¥–ª—è –∑–∞–¥–∞—á, –∑–∞–∫–∞–∑–æ–≤, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API (Swagger/OpenAPI).

üõ°Ô∏è –ö–∞—á–µ—Å—Ç–≤–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
üîÑ –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –≤—Å–µ—Ö –¥–µ–Ω–µ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

üí≥ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –¥–µ–Ω—å–≥–∞–º–∏.

üí± –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞/–∑–∞–∫–∞–∑–∞.

üë• –†–æ–ª–µ–≤—ã–µ –ø—Ä–∞–≤–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞.

üïµÔ∏è –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞.

üìä –õ–æ–≥–∏ –±–µ–∑ —É—Ç–µ—á–µ–∫ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

üêá RabbitMQ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É –∏ –ø–æ—Ä—è–¥–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π.

‚ú® –¢–µ–ø–µ—Ä—å README –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –∂–∏–≤–æ–π –¥–æ–∫—É–º–µ–Ω—Ç: —Å —ç–º–æ–¥–∑–∏, —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —à–∞–≥–∞–º–∏. –•–æ—á–µ—à—å, —è –¥–æ–±–∞–≤–ª—é –µ—â—ë —Ä–∞–∑–¥–µ–ª ¬´–ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤¬ª (–∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç —É—Å–ø–µ—à–Ω—ã–π commit –∑–∞–¥–∞—á–∏ –∏ –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ DLQ), —á—Ç–æ–±—ã README –±—ã–ª –µ—â—ë –±–æ–ª–µ–µ –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–º?
